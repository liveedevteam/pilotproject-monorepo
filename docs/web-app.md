# Web Application Documentation

This is the main Next.js 16 web application built with the App Router and integrated with tRPC for type-safe API calls.

## Technology Stack

- **Next.js 16** with App Router and React Compiler
- **React 19** for the frontend framework
- **tRPC** for type-safe API integration with React Query
- **Tailwind CSS 4** for styling
- **TypeScript** for type safety
- **@repo/ui** for shared components

## Project Structure

```
apps/web/
├── src/
│   ├── app/                    # Next.js App Router pages
│   │   ├── layout.tsx          # Root layout
│   │   ├── page.tsx            # Home page
│   │   ├── providers.tsx       # App providers (tRPC, etc.)
│   │   └── globals.css         # Global styles
│   ├── trpc/                   # tRPC client configuration
│   │   ├── client.ts           # Client-side tRPC setup
│   │   ├── server.ts           # Server-side tRPC setup
│   │   └── [trpc]/route.ts     # API route handler
│   └── types/
│       └── globals.d.ts        # Type declarations
├── public/                     # Static assets
├── package.json
├── next.config.ts              # Next.js configuration
├── tailwind.config.js          # Tailwind configuration
└── tsconfig.json               # TypeScript configuration
```

## Getting Started

### Development Setup

1. **Start the development server:**

   ```bash
   # From root directory (recommended)
   pnpm dev

   # Or from web app directory
   cd apps/web
   pnpm dev
   ```

2. **Access the application:**
   - Local: http://localhost:3001 (or 3000 if available)
   - The port is automatically assigned if 3000 is in use

### Environment Variables

The web app uses environment variables from:

- `.env.local` (auto-generated by setup script)
- Supabase configuration (if using Supabase)

Required variables:

```bash
DATABASE_URL=postgresql://postgres:postgres@127.0.0.1:[port]/postgres
NEXT_PUBLIC_SUPABASE_URL=http://127.0.0.1:[api-port]
NEXT_PUBLIC_SUPABASE_ANON_KEY=[anon-key]
```

## Features

### Current Implementation

The application currently includes:

1. **Home Page** (`src/app/page.tsx`):
   - Displays "My Monorepo App" title
   - Shows a button from the shared UI component
   - Fetches and displays users from the API using tRPC

2. **tRPC Integration**:
   - Client-side queries with React Query
   - Server-side data fetching capability
   - Type-safe API calls to the backend

3. **Shared Components**:
   - Uses `@repo/ui` Button component
   - Tailwind CSS for styling

### tRPC Usage Examples

#### Client Component (with React Query)

```typescript
"use client";
import { trpc } from "@/trpc/client";

export default function UsersPage() {
  const { data: users, isLoading, error } = trpc.user.getAll.useQuery();

  if (isLoading) return <div>Loading...</div>;
  if (error) return <div>Error: {error.message}</div>;

  return (
    <div>
      {users?.map(user => (
        <div key={user.id}>{user.name}</div>
      ))}
    </div>
  );
}
```

#### Server Component (direct API calls)

```typescript
import { api } from "@/trpc/server";

export default async function UsersPage() {
  const users = await api.user.getAll();

  return (
    <div>
      {users.map(user => (
        <div key={user.id}>{user.name}</div>
      ))}
    </div>
  );
}
```

## Development Commands

### Web App Specific

```bash
# Start development server
pnpm dev

# Build for production
pnpm build

# Start production server
pnpm start

# Run linting
pnpm lint
```

### From Root Directory

```bash
# Start all development servers
pnpm dev

# Build all packages and apps
pnpm build

# Run linting across all workspaces
pnpm lint

# Run type checking
pnpm type-check
```

## Adding New Features

### Creating New Pages

1. **Create page file in `src/app/`:**

   ```typescript
   // src/app/users/page.tsx
   export default function UsersPage() {
     return <div>Users Page</div>
   }
   ```

2. **Add navigation if needed:**
   ```typescript
   // src/app/layout.tsx or component
   <Link href="/users">Users</Link>
   ```

### Adding API Integration

1. **Use existing tRPC procedures:**

   ```typescript
   const users = trpc.user.getAll.useQuery();
   const createUser = trpc.user.create.useMutation();
   ```

2. **Add new procedures in the API package:**
   - See [API Documentation](./api.md) for details

### Styling Components

1. **Use Tailwind CSS classes:**

   ```typescript
   <div className="flex items-center justify-center p-4">
     <h1 className="text-2xl font-bold">Title</h1>
   </div>
   ```

2. **Use shared UI components:**

   ```typescript
   import { Button, Card } from "@repo/ui"

   <Button variant="primary">Click me</Button>
   ```

## Configuration

### Next.js Configuration

Key configuration in `next.config.ts`:

- Transpiles workspace packages (`@repo/ui`, `@repo/api`)
- Enables React Compiler
- Configures Tailwind CSS

### TypeScript Configuration

Extends base configuration from `@repo/config`:

- Strict mode enabled
- Path mapping for `@/` imports
- React JSX configuration

### Tailwind Configuration

- Uses Tailwind CSS 4
- Shared design tokens from `@repo/ui`
- Custom utility classes as needed

## Performance Optimization

### Built-in Optimizations

1. **Next.js 16 Features:**
   - React Compiler for automatic optimizations
   - App Router with streaming
   - Built-in image optimization

2. **tRPC + React Query:**
   - Automatic caching and deduplication
   - Background refetching
   - Optimistic updates

### Custom Optimizations

1. **Code Splitting:**

   ```typescript
   import dynamic from "next/dynamic";

   const HeavyComponent = dynamic(() => import("./HeavyComponent"));
   ```

2. **Image Optimization:**

   ```typescript
   import Image from 'next/image'

   <Image src="/image.jpg" alt="Description" width={500} height={300} />
   ```

## Deployment

### Vercel (Recommended)

1. **Connect repository to Vercel**
2. **Set environment variables in Vercel dashboard**
3. **Deploy automatically on push to main branch**

### Build for Production

```bash
# Build the application
pnpm build

# Test production build locally
pnpm start
```

See [Deployment Documentation](./deployment.md) for detailed deployment guides.

## Troubleshooting

### Common Issues

1. **tRPC Connection Errors:**
   - Check if API is running
   - Verify environment variables
   - Check browser network tab

2. **Styling Issues:**
   - Ensure Tailwind is properly configured
   - Check for class name conflicts
   - Verify `@repo/ui` components are imported correctly

3. **Build Errors:**
   - Run `pnpm type-check` to identify TypeScript issues
   - Check for missing dependencies
   - Verify all packages are built

### Debug Mode

```bash
# Enable Next.js debug mode
DEBUG=* pnpm dev

# Check build output
pnpm build --debug
```

## Testing

### Unit Testing Setup

```bash
# Install testing dependencies (example)
pnpm add -D @testing-library/react @testing-library/jest-dom jest
```

### Testing Components

```typescript
import { render, screen } from '@testing-library/react'
import Home from '@/app/page'

test('renders home page', () => {
  render(<Home />)
  expect(screen.getByText('My Monorepo App')).toBeInTheDocument()
})
```

### Testing tRPC Integration

Use MSW (Mock Service Worker) to mock API calls during testing.

## Next Steps

### Recommended Enhancements

1. **Authentication**: Add user authentication with Supabase Auth
2. **Forms**: Implement forms with validation (React Hook Form + Zod)
3. **State Management**: Add global state management if needed
4. **Testing**: Set up comprehensive testing suite
5. **Error Handling**: Implement error boundaries and monitoring
6. **SEO**: Add metadata and Open Graph tags
7. **PWA**: Convert to Progressive Web App if needed

For more information on the overall architecture, see [Architecture Documentation](./architecture.md).
